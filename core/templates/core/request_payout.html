{% extends 'core/base.html' %}

{% block content %}
<style>
    :root {
        --midnight: #0f172a;
        --accent: #ffc107;
        --soft-bg: #f8fafc;
        /* CONTRAST FIX: Clearly visible inactive colors */
        --nav-inactive-text: #475569; 
        --nav-inactive-icon: #64748b;
        --card-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
    }
    
    body { background-color: var(--soft-bg); }

    /* Glass Sidebar - High Contrast Fix */
    .dash-sidebar {
        background: white;
        border: 1px solid rgba(0,0,0,0.05);
        border-radius: 32px;
        padding: 24px;
        box-shadow: var(--card-shadow);
    }

    .dash-nav .nav-link {
        color: var(--nav-inactive-text) !important; 
        font-weight: 700;
        padding: 14px 20px;
        border-radius: 16px;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        margin-bottom: 8px;
        font-size: 0.95rem;
        text-decoration: none;
    }

    .dash-nav .nav-link i { 
        margin-right: 14px; 
        font-size: 1.25rem; 
        color: var(--nav-inactive-icon);
    }

    /* Active State for Payouts */
    .dash-nav .nav-link.active {
        background-color: var(--midnight) !important;
        color: white !important;
        box-shadow: 0 8px 20px rgba(15, 23, 42, 0.25);
    }

    .dash-nav .nav-link.active i { color: white !important; }

    .dash-nav .nav-link:not(.active):hover {
        background-color: #f1f5f9;
        color: var(--midnight) !important;
        transform: translateX(5px);
    }

    /* Payout Card Styling */
    .payout-card {
        border: 1px solid rgba(0,0,0,0.04);
        border-radius: 32px;
        background: white;
        box-shadow: 0 20px 50px rgba(15, 23, 42, 0.1);
        overflow: hidden;
    }

    .payout-header {
        background: linear-gradient(135deg, var(--midnight) 0%, #1e293b 100%);
        padding: 50px 30px;
        text-align: center;
        color: white;
        border-bottom: 5px solid var(--accent);
    }

    .payout-header h2 {
        font-weight: 800;
        letter-spacing: -1.5px;
        text-transform: uppercase;
    }

    .payout-body { padding: 40px; }

    /* Balance Banner */
    .balance-banner {
        background: var(--soft-bg);
        border-radius: 20px;
        padding: 25px;
        text-align: center;
        margin-bottom: 35px;
        border: 1px solid rgba(0,0,0,0.05);
    }

    .balance-label {
        font-weight: 800;
        color: var(--nav-inactive-icon);
        font-size: 0.7rem;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        display: block;
        margin-bottom: 5px;
    }

    .balance-amount {
        font-size: 2.2rem;
        font-weight: 800;
        color: var(--midnight);
        letter-spacing: -1px;
    }

    /* Form Elements */
    .form-label-custom {
        font-weight: 800;
        color: var(--midnight);
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 10px;
        display: block;
    }

    .input-custom {
        border-radius: 15px !important;
        padding: 14px 18px;
        border: 2px solid #f1f5f9;
        background-color: #f8fafc;
        font-size: 1rem;
        transition: 0.3s;
        width: 100%;
        color: var(--midnight);
        font-weight: 600;
    }

    .input-custom:focus {
        background-color: #fff;
        border-color: var(--accent);
        box-shadow: 0 0 0 5px rgba(255, 193, 7, 0.15);
        outline: none;
    }

    .btn-withdraw-premium {
        background: var(--midnight);
        color: white;
        border: none;
        border-radius: 15px;
        padding: 16px;
        font-weight: 800;
        letter-spacing: 1px;
        width: 100%;
        text-transform: uppercase;
        transition: 0.3s;
        margin-top: 15px;
    }

    .btn-withdraw-premium:hover {
        background: var(--midnight-dark);
        color: var(--accent);
        transform: translateY(-3px);
        box-shadow: 0 10px 20px rgba(15, 23, 42, 0.15);
    }

    .info-box {
        background: #fffbeb;
        border: 1px solid #fef3c7;
        color: #92400e;
        border-radius: 15px;
        padding: 15px;
        font-size: 0.85rem;
        font-weight: 600;
        display: flex;
        align-items: center;
    }
</style>

<div class="container py-5 mt-3">
    <div class="row g-4">
        <div class="col-lg-3">
            <div class="dash-sidebar mb-4">
                <nav class="nav flex-column dash-nav">
                    <a class="nav-link" href="{% url 'dashboard' %}"><i class="bi bi-grid-fill"></i> Overview</a>
                    <a class="nav-link" href="{% url 'referrals' %}"><i class="bi bi-people-fill"></i> Refer & Earn</a>
                    <a class="nav-link" href="{% url 'edit_profile' %}"><i class="bi bi-person-fill-gear"></i> Settings</a>
                    <a class="nav-link active" href="{% url 'request_payout' %}"><i class="bi bi-bank2"></i> Payouts</a>
                    <hr class="opacity-10 my-4">
                    <a class="nav-link text-danger" href="#" onclick="confirmLogout(event)">
                        <i class="bi bi-power"></i> Logout
                    </a>
                </nav>
            </div>
        </div>

        <div class="col-lg-9">
            <div class="payout-card">
                <div class="payout-header">
                    <h2 class="mb-1">Request Payout</h2>
                    <p class="small opacity-75 fw-500 mb-0">Withdraw your earnings to your bank account</p>
                </div>

                <div class="payout-body">
                    <div class="balance-banner shadow-sm">
                        <span class="balance-label">Current Wallet Balance</span>
                        <div class="balance-amount">₦{{ user.profile.balance|floatformat:2 }}</div>
                    </div>

                    <form method="POST">
                        {% csrf_token %}
                        
                        {% if form.non_field_errors %}
                            <div class="alert alert-danger rounded-3 fw-bold small mb-4">{{ form.non_field_errors }}</div>
                        {% endif %}

                        <div class="mb-4">
                            <label class="form-label-custom">Withdrawal Amount (₦)</label>
                            {{ form.amount }}
                            <div class="small fw-700 text-muted mt-2"><i class="bi bi-info-circle me-1 text-accent"></i> Minimum payout: ₦1,000.00</div>
                            {% if form.amount.errors %}
                                <div class="text-danger small mt-2 fw-800">{{ form.amount.errors }}</div>
                            {% endif %}
                        </div>

                        <hr class="my-4 opacity-10">

                        <div class="mb-4">
                            <label class="form-label-custom">Bank Institution</label>
                            {{ form.bank_name }}
                            {% if form.bank_name.errors %}
                                <div class="text-danger small mt-2 fw-800">{{ form.bank_name.errors }}</div>
                            {% endif %}
                        </div>

                        <div class="row g-4">
                            <div class="col-md-6 mb-4">
                                <label class="form-label-custom">Account Number</label>
                                {{ form.account_number }}
                                {% if form.account_number.errors %}
                                    <div class="text-danger small mt-2 fw-800">{{ form.account_number.errors }}</div>
                                {% endif %}
                            </div>
                            <div class="col-md-6 mb-4">
                                <label class="form-label-custom">Account Holder Name</label>
                                {{ form.account_name }}
                                {% if form.account_name.errors %}
                                    <div class="text-danger small mt-2 fw-800">{{ form.account_name.errors }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="info-box mb-4">
                            <i class="bi bi-shield-check fs-4 me-3"></i>
                            <span>Verification Required: Payouts are reviewed and processed within 24-48 business hours.</span>
                        </div>

                        <button type="submit" class="btn btn-withdraw-premium shadow-sm">
                            Submit Request
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Injects premium styles into Django-generated form inputs
    document.querySelectorAll('input, select').forEach(el => {
        el.classList.add('input-custom');
    });
</script>
{% endblock %}