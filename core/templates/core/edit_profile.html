{% extends 'core/base.html' %}

{% block content %}
<style>
    :root {
        --vouchly-blue: #002060;
        --vouchly-gold: #ffc107;
        --soft-bg: #f0f2f5;
    }

    body { background-color: var(--soft-bg); }

    /* Main Container Fix */
    .edit-profile-wrapper {
        display: flex;
        justify-content: center;
        padding: 20px 15px;
    }

    .edit-profile-card {
        width: 100%;
        max-width: 450px; /* Limits width on desktop, full width on mobile */
        border: none;
        border-radius: 24px;
        background: white;
        box-shadow: 0 10px 30px rgba(0,32,96,0.1);
        overflow: hidden;
    }

    .edit-header {
        background: var(--vouchly-blue);
        padding: 40px 20px 60px;
        color: white;
        text-align: center;
    }

    /* AVATAR ALIGNMENT FIX */
    .avatar-preview-wrapper {
        position: relative;
        width: 120px;
        height: 120px;
        margin: -60px auto 20px; /* Centers exactly and overlaps the blue header */
        z-index: 10;
    }

    .avatar-preview-lg {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border: 4px solid white;
        background: white;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .camera-btn {
        position: absolute;
        bottom: 5px;
        right: 5px;
        background: var(--vouchly-gold);
        color: var(--vouchly-blue);
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid white;
        cursor: pointer;
    }

    /* FORM ALIGNMENT */
    .edit-body {
        padding: 0 25px 30px;
    }

    .form-group-custom {
        margin-bottom: 20px;
        text-align: left;
    }

    .form-label-custom {
        font-weight: 800;
        color: var(--vouchly-blue);
        font-size: 0.75rem;
        text-transform: uppercase;
        margin-bottom: 5px;
        display: block;
    }

    .input-custom {
        border-radius: 12px;
        padding: 12px 15px;
        border: 1px solid #ddd;
        width: 100%;
        background-color: #fdfdfd;
        font-size: 0.95rem;
    }

    .btn-update {
        background: var(--vouchly-blue);
        color: white;
        border-radius: 50px;
        padding: 14px;
        font-weight: 700;
        border: none;
        width: 100%;
        margin-top: 10px;
        transition: 0.3s;
    }

    .btn-update:hover {
        background: #003399;
        color: white;
    }

    input[type="file"] { display: none; }
</style>

<div class="edit-profile-wrapper">
    <div class="edit-profile-card">
        <div class="edit-header">
            <h4 class="fw-bold mb-0">Update Profile</h4>
            <p class="small opacity-75 mb-0">Customize your public appearance</p>
        </div>

        <div class="edit-body">
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                
                <div class="avatar-preview-wrapper">
                    <label for="id_image" class="d-block w-100 h-100">
                        <img id="imagePreview" src="{{ user.profile.image.url }}" class="rounded-circle avatar-preview-lg">
                        <div class="camera-btn shadow-sm">
                            <i class="bi bi-camera-fill"></i>
                        </div>
                    </label>
                    <input type="file" name="image" id="id_image" accept="image/*" onchange="previewImage(event)">
                </div>

                <div class="form-group-custom">
                    <label class="form-label-custom">Username</label>
                    <input type="text" class="input-custom" value="{{ user.username }}" readonly style="background-color: #f8f9fa;">
                </div>

                <div class="form-fields-container">
                    {% for field in form %}
                        {% if field.name != "image" %}
                            <div class="form-group-custom">
                                <label class="form-label-custom">{{ field.label }}</label>
                                {{ field }}
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>

                <div class="text-center mt-4">
                    <button type="submit" class="btn btn-update shadow">Save Changes</button>
                    <div class="mt-3">
                        <a href="{% url 'dashboard' %}" class="text-muted text-decoration-none small fw-bold">Cancel & Return</a>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Preview image logic
    function previewImage(event) {
        const reader = new FileReader();
        reader.onload = function() {
            const output = document.getElementById('imagePreview');
            output.src = reader.result;
        };
        reader.readAsDataURL(event.target.files[0]);
    }

    // Auto-apply styling to Django form inputs
    document.querySelectorAll('.edit-body input:not([type="file"])').forEach(input => {
        input.classList.add('input-custom');
    });
</script>
{% endblock %}